<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Sediment Transport Geological Scale">
    <meta name="author" content="Tristan Salles">

    <title>SgFm - Sediment Transport @ Geological Scale</title>
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/freepage.css" rel="stylesheet" type="text/css">

    <!-- Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/favicon.png" />
    <link rel="shortcut icon" href="img/favicon.png" />

    <!-- IE8 support for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
	
	<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_light.min.css">
	<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
    <script>
     hljs.tabReplace = '    ';
     hljs.initHighlightingOnLoad();
	</script>
	
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-28324363-2', 'lecode-model.github.io');
	  ga('send', 'pageview');

	</script>

</head>

<body id="page-top" class="overview">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://lecode-model.github.io/SGFM/index.html">SgFm framework</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li class="page-scroll">
                        <a href="#structure">Structure</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#paraview">Paraview</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#fatiando">Seismic</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#geocell">GeoCellular</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <header>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <img class="img-responsive" src="img/visual.png" alt="">
                    <div class="intro-text">
                        <span class="name">Post Processing Tips</span>
                        <span class="skills">Exploring Lecode Output</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

	<section id="structure">
    	<div class="container">
	       	<div class="row">
             	<div class="col-lg-12">
					<br>
                	<h2>Lecode output structure</h2>
    	        </div>
    	   	</div>
	   		<div class="row">
    	      	<div class="col-lg-12 text-left">
	    	  		<p>
					</p>
				</div>
    	   	</div>   	
		</div>
		<div class="col-lg-12 text-center">
   			<hr class="star-primary">
   		</div>
 	</section>

	<section id="paraview">
    	<div class="container">
	       	<div class="row">
             	<div class="col-lg-12">
                	<h2>Using Paraview scripts</h2>
    	        </div>
    	   	</div>
	   		<div class="row">
    	      	<div class="col-lg-12 text-left">
	    	  		<p>
						To look at simulation results such as time series, <code>XmF</code> and <code>XdmF</code> files we recommend to use <a href="http://www.paraview.org" target="_blank">Paraview</a>. 
						<strong>ParaView</strong> is an open-source, multi-platform data analysis and visualisation application built on top of <code>VTK</code>. 
						<br>						<br>
						In addition to the built-in filters and functionalities embedded in this visualisation software, we have developed several post-processing scripts based on <code>NumPy</code> and <code>VTK</code> libraries. 
						<br>
						These scripts help to generate additional informations from <code>Lecode</code> simulation (<i>e.g.</i>, consecutive time stepping elevation differences to estimate erosion - deposition surfaces through time, or cumulative thickness computation for specific types of materials ...)
					</p>
				</div>
    	   	</div>   	
		</div>
		<div class="col-lg-12 text-center">
   			<hr class="star-primary">
   		</div>
 	</section>

	<section id="fatiando">
    	<div class="container">
	       	<div class="row">
             	<div class="col-lg-12">
                	<h2>&lt;SeismicLine&gt; Plugin</h2>
    	        </div>
    	   	</div>

	   		<div class="row">
    	      	<div class="col-lg-12 text-left">
	    	  		<p>
						<strong>Lecode Seismic Plugin</strong> makes it possible to extract a given cross section within the modelled stratigraphic record along the main axes of the domain. Two files are generated by <strong>Lecode</strong> in the <code>runfiles</code> output folder.<br>
						The first records for each node along the desired seismic line: its position on the stratigraphic layer, its mean grain size and its porosity value. <br>
						The second gives the envelop (bottom and top locations) of the stratigraphic record.<br>
						<br>
						Below we provide a seismic script which shows a really simple example of workflow that can be used to extract the seismic attributes from the model for further processing in a seismic modelling framework such <a href="http://fatiando.readthedocs.org/en/releases/install.html" target="_blank">Fatiando</a> or <a href="http://www.reproducibility.org/wiki/Main_Page" target="_blank">RSF Madagascar</a>.<br>
						<br>
					</p>
				</div> 
    	   	</div>
			
			<div class="col-lg-10 col-lg-offset-1 text-center">
            	<a href="#portfolioModal2" class="portfolio-link" data-toggle="modal">
                	<div class="caption">
                    	<div class="caption-content">
                        	<span style="color:#2c3e50"><i class="fa fa-eye fa-1x"></i> </span>
<span style="color:#2c3e50; font-family:Montserrat; font-size:16px; font-weight:normal;">Click here to see Seismic script</span>
                        </div>
                    </div>
                </a>
            </div>
			
	   		<div class="row">
    	      	<div class="col-lg-12 text-left">
	    	  		<p>
						Our future goals are to develop some algorithms based on geophysical forward modelling, uncertainty quantification and inversion to minimise global mismatch between stratigraphic predictions and observations. 
					</p>
				</div>
    	   	</div>

			<div class="row">
  				<div class="col-lg-10 col-lg-offset-1 text-center"><br>
					<img src="figures/seismic.png" class="img-responsive img-centered" alt=""><br>
				</div>
			</div>
			
		</div>
		<div class="col-lg-12 text-center">
   			<hr class="star-primary">
   		</div>
 	</section>
	
	<section id="geocell">
    	<div class="container">
	       	<div class="row">
             	<div class="col-lg-12">
                	<h2>&lt;RMSModel&gt; Plugin</h2>
    	        </div>
    	   	</div>
	   		<div class="row">
    	      	<div class="col-lg-12 text-left">
	    	  		<p>
					</p>
				</div>
    	   	</div>
		</div>
 	</section>	
	
	<footer class="text-center">
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; 2014 - SgFm Framework
                    </div>
                </div>
            </div>
        </div>
    </footer>
			
    <div class="scroll-top page-scroll visible-xs visble-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

  	<!-- Portfolio Modals -->
	<div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 col-lg-offset-1">
                        <div class="modal-body" align="left">
                            <pre><code>"""
Transforming Lecode irregularly sampled cross section dataset to a regularly spaced grid.
python lecode_gridding.py -s seismic.csv -e envelop.csv -l 54375 -r 108750 -b -2740 -t -470 -d 5
"""
import sys, math, numpy, getopt
from scipy import interpolate
from numpy import *
from scipy import *
import matplotlib 
from fatiando import gridder, utils
from fatiando.vis import mpl

#def main(argv):

# Define font size and type
font = {'family' : 'normal',
        'size'   : 6}
matplotlib.rc('font', **font)

total = len(sys.argv)

if total == 1:
    print 'Some required fields are missing'
    print 'Use: python lecode_gridding.py -h for parameter declaration'
    sys.exit(2)
elif total > 2 and total < 15:
    print 'Some required fields are missing'
    print 'Use: python lecode_gridding.py -h for parameter declaration'
    sys.exit(2)

try:
    opts, args = getopt.getopt(sys.argv[1:],"hs:e:l:r:b:t:d:")
except getopt.GetoptError:
    print 'Usage: python lecode_gridding.py -s &lt;seismic&gt; -e &lt;envelop&gt; -l &lt;hmin&gt; -r &lt;hmax&gt; -b &lt;vmin&gt; -t &lt;vmax&gt; -d &lt;dx&gt;'
    print '-s : name of the seismic file exported from Lecode simulation'
    print '-e : name of the envelop file exported from Lecode simulation'
    print '-l : regular grid minimal horizontal value (left)'
    print '-r : regular grid maximal horizontal value (right)'
    print '-b : regular grid minimal vertical value (bottom)'
    print '-t : regular grid maximal vertical value (top)'
    print '-d : regular grid spacing'
    print 'Note: you need to ensure that the vertical and horizontal are both multiple of the specify spacing'
    sys.exit(2)
 
for opt, arg in opts:
    if opt == '-h':
    	print 'Usage: python lecode_gridding.py -s &lt;seismic&gt; -e &lt;envelop&gt; -l &lt;hmin&gt; -r &lt;hmax&gt; -b &lt;vmin&gt; -t &lt;vmax&gt; -d &lt;dx&gt;'
    	print '-s : name of the seismic file exported from LECODE simulation'
    	print '-e : name of the envelop file exported from LECODE simulation'
    	print '-l : regular grid minimal horizontal value (left)'
    	print '-r : regular grid maximal horizontal value (right)'
    	print '-b : regular grid minimal vertical value (bottom)'
    	print '-t : regular grid maximal vertical value (top)'
    	print '-d : regular grid spacing'
    	print 'Note: you need to ensure that the vertical and horizontal are both multiple of the specify spacing'
        sys.exit()
    elif opt == "-s":
        ifile = arg
    elif opt == "-e":
        ofile = arg
    elif opt == "-l":
        hmin = float( arg )
    elif opt == "-r":
        hmax = float( arg )
    elif opt == "-b":
        vmin = float( arg )
    elif opt == "-t":
        vmax = float( arg )
    elif opt == "-d":
        dx = float( arg )
        
# Open and read file from std, and assign data (horizontal, vertical, mean grain size & porosity) 
# columns to an array.
x,y,mgz,poro = loadtxt( ifile, skiprows=0, delimiter=',', unpack = True)
            
# Extensions
hext = int( ( hmax - hmin ) / dx )
vext = int( ( vmax - vmin ) / dx )

# !!! Be careful the shape is defined as ( ny, nx )
shape = ( int( vext ) + 1, int( hext ) + 1 )

# Interpolation
grdx, grdy, gmgz = gridder.interp( x, y, mgz, shape, area=(hmin, hmax, vmin, vmax) , algorithm='cubic', extrapolate=True)
gx, gy, gporo = gridder.interp( x, y, poro, shape, area=(hmin, hmax, vmin, vmax) , algorithm='cubic', extrapolate=True)

# Open and read file from std, and assign first three (horizontal, low, high) columns to an array.
line,low,high = loadtxt( ofile, skiprows=0, delimiter=',', unpack = True)
xnew = linspace(hmin,hmax,int(rint((hmax-hmin)/dx+1)))

# Create the envelop bottom function
bfunc = interpolate.splrep(line,low,s=0)
envbot = interpolate.splev(xnew,bfunc,der=0)

# Create the envelop top function
tfunc = interpolate.splrep(line,high,s=0)
envtop = interpolate.splev(xnew,tfunc,der=0)

# Mask interpolated regular data using the envelope
k = 0
p = 0
vp = zeros(grdx.size)
vs = zeros(grdx.size)

# Here is a simple example which link porosity to velocity using Dominico formula 
for i in nditer(grdx):
    if k > hext:
        k = 0
    if grdy[ p ] < envbot[ k ] :		
        gmgz[ p ] = nan
        gporo[ p ] = nan
        vp[ p ] = nan
        vs[ p ] = nan
    elif grdy[ p ] > envtop[ k ] :		
        gmgz[ p ] = nan
        gporo[ p ] = nan
        vp[ p ] = nan
        vs[ p ] = nan
    else:
       	vp[ p ] = 1.0 / (0.163 + 0.365 * gporo[ p ] ) 
        vs[ p ] = 1.0 / (0.224 + 0.889 * gporo[ p ] )
    k = k + 1
    p = p + 1
       
savetxt('seismic_reg.csv',column_stack((grdx, grdy, gmgz, gporo)), fmt='%g', delimiter=',')
                
# Plot interpolated values
mpl.figure()

mpl.subplot(5, 1, 1)
mpl.title("Lecode line scattered points and cubic-spline envelop")
mpl.scatter(x, y, c=gmgz, label='points')
mpl.plot(xnew,envbot,c="cyan",linewidth=2.5)
mpl.plot(xnew,envtop,c="magenta",linewidth=2.5)
mpl.colorbar()

mpl.subplot(5, 1, 2)
mpl.title("Density map")
mpl.contourf(grdx, grdy, gmgz, shape, 200)
mpl.colorbar()

mpl.subplot(5, 1, 3)
mpl.title("Net 2 Gross map")
mpl.contourf(grdx, grdy, gporo, shape, 200)
mpl.colorbar()
mpl.axis('scaled')
mpl.plot(x, y, '.k', label='data points', alpha=0.4, ms=4 )
mpl.legend(loc='lower right', numpoints=1)

mpl.subplot(5, 1, 4)
mpl.title("S-wave velocity map")
mpl.contourf(grdx, grdy, vs, shape, 200)
mpl.colorbar()

mpl.subplot(5, 1, 5)
mpl.title("P-wave velocity map")
mpl.contourf(grdx, grdy, vp, shape, 200)
mpl.colorbar()

mpl.show()
</code></pre>
					</p>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="js/classie.js"></script>
    <script src="js/cbpAnimatedHeader.js"></script>
    <script src="js/freelancer.js"></script>

</body>

</html>
