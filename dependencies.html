<!doctype html>
<html>
  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>SGFM Framework</title>

	<link rel="stylesheet" href="stylesheets/styles.css">
	<link rel="stylesheet" href="stylesheets/pygment_trac.css">
	<link rel="icon" type="image/png" href="figures/favicon.png" />
     <link rel="shortcut icon" href="figures/favicon.png" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
  </head>
  
  
  <body>
	<div class="wrapper">
	
	  <header>
		<h1>Stratigraphic &amp; Geomorphic Forward Modelling Framework </h1>
		<h4>Sediment Transport @ Geological Scales.</h4>

		<p class="view"><a href="https://github.com/lecode-model/SGFM">
			<stronger>View the Doc on GitHub</stronger> <small>Lecode-model/SGFM</small></a>
		</p>

		<ul>
		  <li><a href="https://github.com/lecode-model/SGFM/zipball/master">Download <strong>ZIP File</strong></a></li>
		  <li><a href="https://github.com/lecode-model/SGFM/tarball/master">Download <strong>TAR Ball</strong></a></li>
		  <li><a href="https://github.com/lecode-model/SGFM">View On <strong>GitHub</strong></a></li>
		</ul>
		
		<p class="Main"><a href="index.html">
			<stronger>Main</stronger> <small>The way back home...</small></a>
		</p>
		
        <p class="overview"><a href="overview.html">
        	<stronger>LECODE Capability in a Nutshell</stronger> <small>A quick overview...</small></a>
        </p>
        
		<p class="dependencies"><a href="dependencies.html">
			<stronger>Installation</stronger> <small>Dependencies requirements</small></a>
			<small>
      		<ul2>
				<li2> <a href="#LECODE-gnu">Compilers</a></li2>
				<li2> <a href="#LECODE-mpi">MPI</a></li2>
				<li2> <a href="#LECODE-hdf5">HdF5</a></li2>
				<li2> <a href="#LECODE-fox">XmL</a></li2>
				<li2> <a href="#LECODE-tree">kd-Tree</a></li2>
				<li2> <a href="#LECODE-tri">Gridding</a></li2>
				<li2> <a href="#LECODE-built">LECODE</a></li2>
				<li2><font color="white"> .. </font></li2> 
			</ul2>
			</small>
		</p>
		
		<p class="input"><a href="inputs.html">
			<stronger>XmL Input</stronger> <small>How input files are structured ?</small></a>
		</p>
		
		<p class="examples"><a href="examples.html">
        	<stronger>Getting Started</stronger> <small>Hands-on examples...</small></a>
        </p>
	  	 
	  	 <p class="wiki"><a href="wiki.html">
			<stronger>Forum</stronger> <small>Connect with the community.</small></a>
		</p>
	  </header>
	
	  <section>
		 
		 <h3>
			<a name="LECODE-dep" class="anchor" href="#LECODE-dep">
			<span class="octicon octicon-link"></span></a>Installation Guide 
		</h3>
		
		<p>
			This section provides steps and links on obtaining and setting up <strongest>LECODE</strongest> model.<br>
			The following instructions assume a beginner’s level of familiarity with the Unix/Linux operating environment, including:
			<ul>
				<li> How to open a terminal window,
				<li> How to navigate between directories using a terminal application,
				<li> How to open, edit, save and close a file using an editor through a terminal application.
			</ul>
			There are many beginners Unix/Linux guides available as textbooks and on the Internet, including the 
			<a href="http://www.ee.surrey.ac.uk/Teaching/Unix">Unix Tutorial for Beginners</a>.<br>
			<br>
			For help, advice or the latest information, check out the documentation in the child pages as well as the wiki or contact the
			<a href="mailto:tristan.salles@csiro.au">SGFM support team</a> and we’ll help you sort it out.<br>
			<br> 
			<strongest>LECODE</strongest> relies on a suite of software applications, which need to be installed prior to installing 
			<strongest>LECODE</strongest>. It is recommended that you install each program in the order listed. 
			Below is the list of required dependencies:
			<!--ul>
				<li> <a href="#LECODE-gnu">C, C++ &amp; Fortran Compilers</a>
				<li> <a href="#LECODE-mpi">Parallel MPI Message-passing library</a>
				<li> <a href="#LECODE-hdf5">HdF5</a>
				<li> <a href="#LECODE-fox">XmL</a>
				<li> <a href="#LECODE-tree">kd-Tree</a>
				<li> <a href="#LECODE-tri">Gridding</a>
				<li> <a href="#LECODE-built">LECODE</a>
			</ul-->
			<table cellpadding="0" cellspacing="0" border="0" style="width:400px">
				<tr>
  					<td>
				  		<ul>
							<li> <a href="#LECODE-gnu">Compilers</a>
							<li> <a href="#LECODE-mpi">MPI</a>
						</ul>
 					</td>
					<td>
  						<ul>
							<li> <a href="#LECODE-hdf5">HdF5</a>
							<li> <a href="#LECODE-fox">XmL</a>
						</ul>
					</td> 
  					<td>
  						<ul>
							<li> <a href="#LECODE-tree">kd-Tree</a>
							<li> <a href="#LECODE-tri">Gridding</a>
						</ul>
					</td>
  					<td>
  						<ul>
							<li> <a href="#LECODE-built">LECODE</a>
						</ul>
					</td>
				</tr>
			</table>
		</p>	
		
		<h3>
			<a name="LECODE-os" class="anchor" href="#LECODE-os">
			<span class="octicon octicon-link"></span></a>Operating Systems
		</h3>
		
		<p>
			<strongest>LECODE</strongest> will work and is supported on:
			<ul>
				<li> Linux-based OS (desktop and supercomputers)
				<li> Mac OS X (Intel)
			</ul>
			<b> <i> Note:  LECODE is currently not available on Windows.</i></b>
		</p>
		
		<h3>
			<a name="LECODE-gnu" class="anchor" href="#LECODE-gnu">
			<span class="octicon octicon-link"></span></a>Compilers
		</h3>
		
		<p>
			<strongest>LECODE</strongest> is currently supported for GNU compilers , however it works as well with Intel compilers. <br>
			Both C, C++ and fortran compilers are required. For Linux OS , they should already been installed with your distribution. <br>
			GNU compilers for Mac OS can be downloaded from the <a href="http://hpc.sourceforge.net">HPC website</a>. To install them you could follow
			the explanations provided on the website or proceed as follow in a Terminal: <pre><code>$ unzip gcc-xxx.tar.gz   
$ sudo tar -xvf gcc-xxx.tar
$ cd /usr/local/bin
$ sudo ln -s /usr/local/gcc-xxx/bin/gcc gcc
$ sudo ln -s /usr/local/gcc-xxx/bin/gfortran gfortran
$ sudo ln -s /usr/local/gcc-xxx/bin/cpp cpp
$ sudo ln -s /usr/local/gcc-xxx/bin/g++ g++
</code></pre>
			Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the path to the installed compilers.
		<pre><code>export PATH=/usr/local/bin:$PATH
export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
			Then check that the version you've just installed of the compilers is set as the default one.
		<pre><code>$ g++ --version
$ gfortran --version   
$ gcc --version 
</code></pre>
		</p>
		
		<h3>
			<a name="LECODE-mpi" class="anchor" href="#LECODE-mpi">
			<span class="octicon octicon-link"></span></a>MPI
		</h3>
		
		<p>
		 <strongest>LECODE</strongest> supports MPICH and OpenMPI.  Below you will find guide to install MPICH.<br> 
		 MPICH can be downloaded from the <a href= "http://www.mpich.org">MPICH website</a>. You will need to download the
		 source code such as the <b>mpich-3.1 (stable release)</b>.  Once downloaded, open a Terminal, go to the untar folder and do:
		 <pre><code>$ tar -xvf mpich3-xxx.tar
$ cd mpich3-xxx
$ CC=gcc FC=gfortran CXX=g++ ./configure --prefix=/usr/local/lecode/mpich --enable-fast=all --enable-shared --enable-sharedlibs=osx-gcc
$ make
$ sudo make install
</code></pre>
			Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the paths to the installed libraries and compilers.
		<pre><code>export MPI_DIR=/usr/local/lecode/mpich
export PATH=$MPI_DIR/bin:$PATH
export LD_LIBRARY_PATH=$MPI_DIR/lib:$LD_LIBRARY_PATH
export DYLD_LIBRARY_PATH=$MPI_DIR/lib:$DYLD_LIBRARY_PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
			Then check that the version you've just installed of the compilers is set as the default one.
		<pre><code>$ which mpicc
$ which mpif90  
$ which mpic++ 
</code></pre>
		</p>
		
		<h3>
			<a name="LECODE-hdf5" class="anchor" href="#LECODE-hdf5">
			<span class="octicon octicon-link"></span></a>Hdf5 Output Format
		</h3>

		<p>
		 <strongest>LECODE</strongest> uses Hdf5 as default library to produce its outputs.<br> 
		 Hdf5 can be downloaded from the <a href= "http://www.hdfgroup.org/HDF5/release/obtain5.html">Hdf5 website</a>. 
		 You will need to download the source code available for all platform such as the <b>HDF5-1.8.13 Source Code</b>. 
		  Once downloaded, open a Terminal and navigate to the untar folder and do:
		 <pre><code>$ CC=mpicc FC=mpif90 ./configure --prefix=/usr/local/lecode/hdf5 --enable-parallel --enable-fortran --enable-shared
</code></pre>
		  After the configuration script has finished, checked the summary of the log which is printed on your screen and ensure that both Hdf5 for Fortran and
		  Hdf5 for C are present as well as the Hdf5 compression	facility (Zlib). If Zlib is missing you will have to install it first following documentation in the 
		  <a href= http://www.zlib.net">Zlib website</a>. <br>
		 <pre><code>$ make
$ sudo make install
</code></pre>
			Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the paths to the installed libraries and compilers.
		<pre><code>export HDF5_DIR=/usr/local/lecode/hdf5
export PATH=$HDF5_DIR/bin:$PATH
export LD_LIBRARY_PATH=$HDF5_DIR/lib:$LD_LIBRARY_PATH
export DYLD_LIBRARY_PATH=$HDF5_DIR/lib:$DYLD_LIBRARY_PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
		</p>
		
		<h3>
			<a name="LECODE-fox" class="anchor" href="#LECODE-fox">
			<span class="octicon octicon-link"></span></a>XmL parser
		</h3>
		
		<p>
		 <strongest>LECODE</strongest> uses FoX XmL parser for fortran.<br> 
		 FoX can be downloaded from the <a href= "http://www1.gly.bris.ac.uk/~walker/FoX/source">FoX repository</a>. 
		 You will need to download the source code available as a tarball such as <b>FoX-4.1.2.tar.gz</b>. 
		  Once downloaded, open a Terminal and navigate to the untar folder and do:
		 <pre><code>$ cd FoX-xxx
$ FCFLAGS='-O2 -fPIC' FC=mpif90 ./configure --prefix=/usr/local/lecode/FoX
$ make
$ sudo make install
</code></pre>
		Once compiled, you will need to open the <i>/usr/local/lecode/FoX/bin/FoX-config</i> file using your preferred editing file:
		 <pre><code>$ sudo emacs /usr/local/lecode/FoX-xxx/bin/FoX-config
</code></pre>
		And change the comp_prefix (third line of the file) to the correct prefix in this case: <i>/usr/local/lecode/FoX</i> and delete the 
		<i>/objs</i> at the end of the path.<br>
		<br>
		Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the paths to the installed libraries and compilers.
		<pre><code>export PATH=/usr/local/lecode/FoX/bin:$PATH
export LD_LIBRARY_PATH=/usr/local/lecode/FoX/lib:$LD_LIBRARY_PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
		</p>
	  
		<h3>
			<a name="LECODE-tree" class="anchor" href="#LECODE-tree">
			<span class="octicon octicon-link"></span></a>KdTree
		</h3>

		<p>
		 <strongest>LECODE</strongest> uses a kdTree search algorithm to position flow walkers over the grids.<br> 
		 A kdTree algorithm for fortran can be downloaded from the <a href= "https://github.com/jmhodges/kdtree2">kdTree repository</a>. 
		 Before downloading the required files, you will have to create a folder called <i>kdtree2</i> on your desktop and then download the following files from the
		 kdTree webpage:
		 <ul>
			 <li> kdtree.f90, and 
			 <li> kdtree2.f90
		</ul>
		Then in your preferred text editor, copy the lines below in a new file named <i>Makefile</i> within the new <i>kdtree2</i> folder:
		<pre><code># KD_TREE2
# For gfortran
#
FLAGSOPT= -O3 -funroll-loops --param max-unroll-times=2 -cpp -ftree-vectorize -ffast-math -lstdc++
F90=mpif90
#
FLAGS= ${FLAGSMACHINE} ${FLAGSALWAYS} ${FLAGSOPT}  
MY_DIR=`basename ${PWD}`
all:  kdtree2_test kdtree_test 
	ar -rcs libkdtree.a kdtree.o  kdtree2.o
kdtree2_test: kdtree2.o
	${F90} ${FLAGS} -c kdtree2.o
kdtree_test: kdtree.o
	${F90} ${FLAGS} -c kdtree.o
%.o :: %.f90
	${F90} ${FLAGS} -c $<
clean:
	/bin/rm -f *.o *.mod *.il  
</code></pre>
		Save and close the file and open the downloaded <i>kdtree2.f90</i> file and change lines 22 and 23 to:
		 <pre><code>! integer, parameter :: kdkind = sp
integer, parameter :: kdkind = dp
</code></pre>
		It will enable the use of double precision real numbers.<br>
		Then compile the kdTree library by writing the following command in your Terminal:
		<pre><code>$ cd ~/Desktop/kdtree2
$ make 
</code></pre>
		Once compiled, move the folder to a place that will be pointed out within <strongest>LECODE</strongest> configuration file. The default is:
		 <pre><code>$ sudo mv ~/Desktop/kdtree2 /usr/local/lecode/kdtree2
</code></pre>
		Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the paths to the installed libraries and compilers.
		<pre><code>export PATH=/usr/local/lecode/kdtree2:$PATH
export LD_LIBRARY_PATH=/usr/local/lecode/kdtree2:$LD_LIBRARY_PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
		</p>
		
	  	<h3>
			<a name="LECODE-tri" class="anchor" href="#LECODE-tri">
			<span class="octicon octicon-link"></span></a>Gridding Library
		</h3>
				<p>
		 To generate the triangular irregular network (TIN), <strongest>LECODE</strongest> uses the Triangle library.<br> 
		 Triangle can be downloaded from the <a href="http://www.cs.cmu.edu/~quake/triangle.html">Triangle website</a>. 
		 You will need to download the source code available as a zip file. <br>
		Once downloaded, open a Terminal and navigate to the zip file and using root privileges move it:
		 <pre><code>$ sudo mv triangle.zip /usr/local/
$ sudo unzip triangle.zip
$ sudo make
</code></pre>
		Then go within the <i>triangle.c</i> file and change the <b>main(int argc, char **argv)</b>  &amp;
		 <b>main(argc, argv)</b> to <b>main2(int argc, char **argv)</b> &amp; <b>main2(argc, argv)</b> at lines 15682 & 15684 respectively.<br>
		Then compile the new file using: 
		<pre><code>$ gcc -O -DLINUX -I/usr/X11R6/include -L/usr/X11R6/lib -c -o ./triangle.o ./triangle.c 
</code></pre>
		Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the paths to the installed libraries and compilers.
		<pre><code>export PATH=/usr/local/lecode/triangle:$PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
			Finally do one of the following depending of your compiler (GNU or Intel):
		<pre><code>$ gcc -O3 -m64 -fno-common -fPIC -c -o triangle.o triangle.c 
$ icc -O3 -m64 -fno-common -fPIC -c -o triangle.o triangle.c 
</code></pre>
		</p>
 
 	  	<h3>
			<a name="LECODE-built" class="anchor" href="#LECODE-built">
			<span class="octicon octicon-link"></span></a>Fire Up LECODE
		</h3>
				<p>
		 If you've obtained the authorisations required for <strongest>LECODE</strongest> source code and if you've managed to install all the dependencies above,
		 you are ready to compile <strongest>LECODE</strongest>.<br> <br> 
		 Prior to starting the compilation process, you will need to check the path to the libraries you've installed on your system as they might differs from one
		 to the other. In <strongest>LECODE</strongest>, the configuration are defined in the <i>config</i> folder. <br>
		 The folder contains a bunch of configuration files associated to different configuration e.g. Linux/Mac or Intel/Gnu. Depending on the ones you've installed 
		 copy of the files and edit it:
		 <pre><code>$ cp Makefile.cfg.osx Makefile.cfg.myconfig
$ emacs Makefile.cfg.myconfig
</code></pre>
		 In the file insure that the paths are set correctly (if not sure look at your <i>~/.profile</i> or <i>~/.bashrc</i> :
		<pre><code>FC= mpif90 
CC=mpicc 
CPP=mpicxx 
FOX=/usr/local/lecode/FoX/bin
TRIANGLELIB=/usr/local/lecode/triangle
HDF5=/usr/local/lecode/hdf5
KDTREE=/usr/local/lecode/kdtree2 
</code></pre>
		  Make the necessary changes and save your file. Now open the Makefile.inc file and change the first line to match with your 
		  new configuration file name:
		  <pre><code>CFGFILE = $(TOP)/config/Makefile.cfg.myconfig
</code></pre>
		If you are using Intel compilers there are 3 other things that needs to be done in the file </i>Classes/ClassGeneral.f90</i>:
		<ul>
			<li>at line 18 of the file: delete the comment "!" in front of the line</li>
			<li>at line 65 of the file: delete the comment "!" in front of the line</li>
			<li>at line 67 of the file: add a comment "!" in front of the line</li>
		</ul>
		Then compile <strongest>LECODE</strongest> sources from the top directory:
		<pre><code>$ make clobber
$ make dist		
</code></pre>
		Then edit your <i>~/.profile</i> in Mac OS or <i>~/.bashrc</i> in Linux environment and set up the paths to the installed libraries and compilers.
		<pre><code>export PATH=/lecode-install-dir/bin:$PATH
export DYLD_LIBRARY_PATH=/lecode-install-dir/build/lib:$DYLD_LIBRARY_PATH
</code></pre>
			Now update the configuration file in your Terminal by typing:
		<pre><code>$ source ~/.profile  (on Mac)
$ source ~/.bashrc  (on Linux)
</code></pre>
			You are now ready to go... well done!
		</p>
	  </section>
	  
	  <footer>
		
		<p>
			<img src="figures/lecode.png" alt="SGFM logo" width="20" hspace="5" align="left">
			<small>Project maintained by the <a href="https://github.com/lecode-model">SGFM Team</a><br>
			<small>Hosted on GitHub Pages.</small>
		</p>
	  </footer>
	  
	</div>
	
	<script src="javascripts/scale.fix.js"></script>
  
  </body>
</html>
